---
title: "Regression Discontinuity Design"
author: ""
date: \today
fontsize: 11pt
linestretch: "1.1"
indent: false
papersize: a4paper
format:
  pdf:
    keep-tex: false
    number-sections: true
    shift-heading-level-by: 0
    toc: false
    pdf-engine: "xelatex"
---

In this problem set, we will use *regression discontinuity design* (RDD) to estimate the effect of incumbency disadvantage in developing democracies.

Regression discontinuity design is usually considered as an identification strategy of "natural" experiment -- using the conceptualization provided by Thad Dunning (UC Berkeley), natural experiment provides us with the opportunity of causal inference as the process of treatment assignment can be considered **as if** random and often the randomization is out of the control

Before you start, please download the dataset from Moodle and import it into `RStudio`. If you would like to submit this problem set, please complete the questions at the end.

# Basic Setup

The intuition of regression discontinuity design (RDD) is as follows -- suppose we can find a variable (**running variable**) that includes an exogenously determined threshold such that observations above the threshold will receive the treatment of interest.

Then we will need to justify that our observations in the study cannot pre-determine which value they will receive with respect to the running variable, which further means that when it is very close to the threshold, no observations can set themselves for sure above or below the threshold. Since only observations above the threshold will receive the treatment, we can infer that this setting will give us the scenario that **for a specified bandwidth around the threshold of the running variable, the assignment of the treatment status can be considered as random.**

For this particular, the idea goes as follows: In close elections, candidates do not know if they will win the elections for sure. As a result, which candidate will win the elections may be considered as a random event. Candidates who win this election will get the incumbency randomly and we can see if they get more or less votes in the next term to estimate the size of **incumbency advantage**.

For similar ideas, please see the following paper:

**Lee, David S. 2008. "Randomized Experiments from Non-random Selection in U.S. House Elections." *Journal of Econometrics 142*(2): 675-697.**

Let's talk about some possible examples of regression discontinuity in class, using the examples compiled by Dunning (2012).

# Variables

For this exercise, we will replicate the following article:

**Kla≈°nja, Marko. 2015. "Corruption and the Incumbency Disadvantage: Theory and Evidence." *Journal of Politics 77*(4): 928-942.**

We will need the following variables:

  - `vote_margin` -- a continuous variable to indicate the vote margin of the winner and the first runner-up in the current election

  - `win` -- a binary indicator to see if the candidate wins the next election

  - `educ_t` -- a continuous variable for the education level in the municipal-year 

## Load Packages

Other than the packages we have used before, we will need the following packages, we will need `rdrobust`. For more information, please see \url{https://rdpackages.github.io/rdrobust/}.

```{r, echo=T, eval=T, message=F}
library(haven)
library(ggplot2)
library(stargazer)
library(tidyverse)
library(rdrobust)
```

## Read Data

```{r, echo=F, eval=T, message=F}
setwd("C:/Users/polar/Downloads/Sandbox/Teaching/AdvQ/Week 08/02 Exercise/Data")

dta <- read_dta("electoral_data.dta")

dta_rdd <- dta %>%
  dplyr::select(win, vote_margin, educ_t) %>%
  mutate(treat = ifelse(vote_margin >= 0, 1, 0)) %>%
  drop_na()

dta_rdd_sel <- dta_rdd %>%
  filter(vote_margin >= -0.1) %>%
  filter(vote_margin <= 0.1) 
```

We will first select the variables we need for this exercise -- note that we will compare candidates/parties who/which won the majority of votes in close elections vs who/which lost.

```{r, echo=F, eval=F, message=F}
dta <- read_dta("electoral_data.dta")
dta_rdd <- dta %>%
  dplyr::select(win, vote_margin, educ_t) %>%
  mutate(treat = ifelse(vote_margin >= 0, 1, 0)) %>%
  drop_na()
summary(dta_rdd$vote_margin)
```

For the purpose of comparison, let's create another dataset for really close elections (in which the margin of victory is within 0.1 percentage points).

```{r, echo=F, eval=F, message=F}
dta_rdd_sel <- dta_rdd %>%
  filter(vote_margin >= -0.1) %>%
  filter(vote_margin <= 0.1) 
```

Here we can use four functions to take a peak at the dataset.

```{r, echo=T, eval=F, message=F}
names(dta_rdd) # list all columns (variables)
ls(dta_rdd) # list all columns (variables) alphabetically
summary(dta_rdd) # show summary statistics
head(dta_rdd) # show first 6 rows
```

## Disable Scientific Notation (optional)

We will also need to use `options` at the very beginning to disable print out our results in scientific notation.

```{r, echo=T, eval=F, message=F}
options(scipen=999)
```

# Visualizing the Discontinuity

```{r, echo=T, eval=T, message=F}
rdplot(dta_rdd$win, dta_rdd$vote_margin)
rdplot(dta_rdd_sel$win, dta_rdd_sel$vote_margin)
```

# Balance Statistics

In a nutshell, we want to see if within the specified bandwidths our treated and control units are statistically identical with respect to the pre-treated covariates. Here we will use the education of the municipality to illustrate.

```{r, echo=T, eval=T, message=F}
t.test(educ_t ~ treat, data=dta_rdd)
t.test(educ_t ~ treat, data=dta_rdd_sel)
```

# Estimating the Effect

## Use Manually Selected Bandwidths

```{r, echo=T, eval=T, message=F}
rdd_simple_1 <- lm(win ~ treat, data=dta_rdd)
rdd_simple_2 <- lm(win ~ treat, data=dta_rdd_sel)

stargazer(list(rdd_simple_1, rdd_simple_2),
          omit.stat = c("f", "rsq", "ser"),
          covariate.labels = c("Treatment"),
          omit = c("as.factor"),
          type = "text",
          digits = 3, 
          no.space = T,
          intercept.bottom = TRUE,
          star.cutoffs = c(0.1, 0.05, 0.01))
```

## Use Bandwidths Selected by the Algorithm

```{r, echo=T, eval=T, message=F}
rdd_robust <- rdrobust(dta_rdd$win, dta_rdd$vote_margin, c=0)
summary(rdd_robust)
```

Let's take a look at the bandwidths selected by the `rdrobust` package.

```{r, echo=T, eval=F, message=F}
rdd_robust$bws
```

# Extended Discussion

  - Sharp v fuzzy regression discontinuity design

  - Geographic discontinuity design and regression discontinuity in time